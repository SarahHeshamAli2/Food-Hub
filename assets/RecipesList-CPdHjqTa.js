import{v as E,j as e,r as m,w as U,x as z,f as q,u as P,e as V,s as O,t as G,y as L,z as Y}from"./index-CXdzRoav.js";import{P as p}from"./index-wUFLzmGo.js";import{I as H}from"./IngredientCard-Dk03GORj.js";import{D as Q}from"./DeleteModal-DskK17_z.js";import"./ThemeProvider-hMXPkh1e.js";import"./divWithClassName-XhbkIWut.js";const X="_container_4migs_1",J="_title_4migs_13",K="_list_4migs_29",W="_item_4migs_43",Z="_actionsContainer_4migs_77",ee="_menuBtn_4migs_103",te="_favoriteBtn_4migs_105",se="_notFavorited_4migs_165",ne="_emptyState_4migs_183",re="_emptyIcon_4migs_197",oe="_contextMenu_4migs_337",ie="_contextMenuItem_4migs_369",ae="_seeMoreButton_4migs_415",c={container:X,title:J,list:K,item:W,actionsContainer:Z,menuBtn:ee,favoriteBtn:te,notFavorited:se,emptyState:ne,emptyIcon:re,contextMenu:oe,contextMenuItem:ie,seeMoreButton:ae},le=({recipeId:s,onDelete:d,closeMenu:l})=>{const b=E(),x=()=>{l(),d&&d(s)},j=()=>{b(`/add-recipe/${s}`),l()};return e.jsx("div",{children:e.jsxs("div",{className:`${c.contextMenu} flex flex-col `,children:[e.jsx("button",{onClick:x,className:c.contextMenuItem,children:"Delete"}),e.jsx("button",{onClick:j,className:c.contextMenuItem,children:"Update"})]})})},ce=s=>{const d=m.useMemo(()=>{if(!s||s.length===0)return[];const r=new Set;return s.forEach(n=>{n.ingredients&&Array.isArray(n.ingredients)&&n.ingredients.forEach(o=>{const a=o.toLowerCase().replace(/,.*$/,"").replace(/\d+/g,"").replace(/\b(cup|cups|tablespoon|tablespoons|teaspoon|teaspoons|pound|pounds|oz|ounces|lb|lbs|tbsp|tsp|ml|g|kg|mg)\b/g,"").replace(/\b(sliced|diced|chopped|minced|cubed|grated|fresh|dried|cooked|raw|for serving)\b/g,"").trim();a&&a.length>2&&r.add(a)})}),Array.from(r).sort()},[s]),l=m.useMemo(()=>{if(!s||s.length===0)return[];const r={};return s.forEach(n=>{n.ingredients&&Array.isArray(n.ingredients)&&n.ingredients.forEach(o=>{const a=o.toLowerCase().replace(/,.*$/,"").replace(/\d+/g,"").replace(/\b(cup|cups|tablespoon|tablespoons|teaspoon|teaspoons|pound|pounds|oz|ounces|lb|lbs|tbsp|tsp|ml|g|kg|mg)\b/g,"").replace(/\b(sliced|diced|chopped|minced|cubed|grated|fresh|dried|cooked|raw|for serving)\b/g,"").trim();a&&a.length>2&&(r[a]=(r[a]||0)+1)})}),Object.entries(r).sort(([,n],[,o])=>o-n).slice(0,10).map(([n])=>n)},[s]);return{allIngredients:d,popularIngredients:l,getIngredientSuggestions:(r,n=5)=>!r||r.length<2?[]:d.filter(o=>o.includes(r.toLowerCase())).slice(0,n),searchRecipesByIngredient:r=>r?s.filter(n=>n.ingredients?n.ingredients.some(o=>o.toLowerCase().includes(r.toLowerCase())):!1):s,searchRecipesByMultipleIngredients:r=>!r||r.length===0?s:s.filter(n=>n.ingredients?r.every(o=>n.ingredients.some(a=>a.toLowerCase().includes(o.toLowerCase()))):!1),getRecipeCountForIngredient:r=>s.filter(n=>{var o;return(o=n.ingredients)==null?void 0:o.some(a=>a.toLowerCase().includes(r.toLowerCase()))}).length}},de=(s,d=300)=>{const[l,b]=m.useState(s);return m.useEffect(()=>{const x=setTimeout(()=>{b(s)},d);return()=>{clearTimeout(x)}},[s,d]),l};A.propTypes={recipes:p.array.isRequired,isSignedIn:p.bool.isRequired,isRegularUser:p.bool.isRequired,isAdmin:p.bool.isRequired,favoriteIds:p.array.isRequired,onToggleFavorite:p.func,onDelete:p.func,onUpdate:p.func,userId:p.string,isLoading:p.bool};function A({recipes:s,isSignedIn:d,isRegularUser:l,isAdmin:b,favoriteIds:x,onToggleFavorite:j,onDelete:N,onUpdate:r,userId:n,isLoading:o}){const[a,_]=m.useState(null),[C,I]=m.useState(9),[i,f]=m.useState(""),[R,v]=m.useState(!1),S=E(),y=de(i,300),{getIngredientSuggestions:D,getRecipeCountForIngredient:M,popularIngredients:k}=ce(s),B=D(y,5),T=(t,u)=>{console.log("Clicked target:",u.target),u.target.closest(`.${c.actionsContainer}`)||S(`/recipes/${t}`)},$=t=>{_(a===t?null:t)},g=s.filter(t=>{var w;const u=t.name.toLowerCase().includes(y.toLowerCase()),h=(w=t.ingredients)==null?void 0:w.some(F=>F.toLowerCase().includes(y.toLowerCase()));return u||h});return e.jsxs("div",{className:c.container,children:[e.jsx("h2",{className:`${c.title} dark:text-white`,children:"Explore Recipes"}),e.jsxs("div",{className:"flex justify-center mb-6",children:["        ",e.jsxs("div",{className:"relative w-full max-w-md",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx(U,{})}),e.jsx("input",{type:"text",placeholder:"Search by recipe name or ingredients...",value:i,onChange:t=>{f(t.target.value),v(!0)},onFocus:()=>v(!0),onBlur:()=>{setTimeout(()=>v(!1),200)},className:"w-full pl-10 pr-10 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#FF7F50] focus:border-transparent transition-all duration-300"}),i&&e.jsx("button",{onClick:()=>{f(""),v(!1)},className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors duration-200",children:e.jsx(z,{})}),R&&!i&&k.length>0&&e.jsxs("ul",{className:"absolute left-0 right-0 bg-white border border-gray-200 mt-2 rounded-lg shadow-lg z-10 overflow-hidden",children:[e.jsx("li",{className:"px-4 py-2 text-xs font-semibold text-gray-500 bg-green-50 border-b",children:"POPULAR INGREDIENTS"}),k.slice(0,5).map((t,u)=>{const h=M(t);return e.jsx("li",{className:"px-4 py-2 text-gray-700 hover:bg-green-50 hover:text-green-800 transition-colors duration-150 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>{f(t),v(!1)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-green-500 mr-2",children:"â­"}),e.jsx("span",{className:"capitalize",children:t})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[h," recipe",h!==1?"s":""]})]})},u)})]}),R&&y&&g.length>0&&e.jsxs("ul",{className:"absolute left-0 right-0 bg-white border border-gray-200 mt-2 rounded-lg shadow-lg z-20 overflow-hidden",children:[e.jsxs("li",{className:"px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50 border-b",children:["RECIPES (",g.length," found)"]}),g.slice(0,3).map(t=>{var w;const u=t.name.toLowerCase().includes(y.toLowerCase()),h=(w=t.ingredients)==null?void 0:w.find(F=>F.toLowerCase().includes(y.toLowerCase()));return e.jsxs("li",{className:"px-4 py-2 text-gray-700 hover:bg-orange-200 hover:text-black-800 transition-colors duration-150 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>{S(`/recipes/${t.id}`),v(!1)},children:[e.jsx("div",{className:"font-medium",children:t.name}),!u&&h&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Contains: ",e.jsx("span",{className:"text-orange-600 font-medium",children:h})]})]},t.id)})]}),R&&y&&y.length>=2&&B.length>0&&!g.length&&e.jsxs("ul",{className:"absolute left-0 right-0 bg-white border border-gray-200 mt-2 rounded-lg shadow-lg z-10 overflow-hidden",children:[e.jsx("li",{className:"px-4 py-2 text-xs font-semibold text-gray-500 bg-blue-50 border-b",children:"SEARCH BY INGREDIENT"}),"              ",B.map((t,u)=>{const h=M(t);return e.jsx("li",{className:"px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-800 transition-colors duration-150 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>{f(t),v(!1)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-blue-500 mr-2",children:"ðŸ¥•"}),e.jsx("span",{className:"capitalize",children:t})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[h," recipe",h!==1?"s":""]})]})},u)})]})]})]}),o?e.jsx(q,{}):e.jsxs(e.Fragment,{children:["          ",g.length===0?e.jsxs("div",{className:c.emptyState,children:[e.jsx("div",{className:c.emptyIcon,children:e.jsx("i",{className:"far fa-utensils"})}),i?e.jsxs(e.Fragment,{children:[e.jsxs("h3",{children:['No recipes found for "',i,'"']}),e.jsx("p",{children:"Try searching for different recipe names or ingredients."})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"No recipes found"}),e.jsx("p",{children:"Try a different search term."})]})]}):e.jsxs(e.Fragment,{children:[i&&g.length>0&&e.jsx("div",{className:"mb-4 text-center text-gray-600",children:e.jsxs("p",{className:"text-sm",children:["Found ",e.jsx("span",{className:"font-semibold text-orange-600",children:g.length}),g.length===1?" recipe":" recipes",i&&` matching "${i}"`]})}),d&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>S("/add-recipe/new-recipe"),className:"bg-[#FF7F50] hover:bg-orange-500 text-white px-4 py-2 rounded-full font-semibold shadow transition duration-300",children:"+ Add New Recipe"})}),e.jsx("ul",{className:c.list,children:g.slice(0,C).map(t=>e.jsx("li",{className:c.item,onClick:u=>T(t.id,u),children:e.jsx(H,{recipe:t,children:e.jsxs("div",{className:c.actionsContainer,onClick:u=>u.stopPropagation(),children:[!b&&d&&e.jsx("button",{onClick:()=>j(t.id),className:`${c.favoriteBtn} ${x.includes(t.id)?"":c.notFavorited}`,"aria-label":x.includes(t.id)?"Remove from favorites":"Add to favorites",children:e.jsx("i",{className:x.includes(t.id)?"fas fa-heart":"far fa-heart"})}),(b||l&&t.userId===n)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:c.menuBtn,onClick:()=>$(t.id),"aria-expanded":a===t.id,children:e.jsx("i",{className:"fas fa-ellipsis-v"})}),a===t.id&&e.jsx(le,{recipeId:t.id,onDelete:N,onUpdate:r,closeMenu:()=>_(null)})]})]})})},t.id))}),g.length>C&&e.jsx("button",{className:c.seeMoreButton,onClick:()=>I(t=>Math.min(t+12,g.length)),children:C>=g.length?"No more recipes":"See More"})]})]})]})}function pe(){const{user:s,isLoaded:d,isSignedIn:l}=P(),{recipes:b,handleDelete:x}=m.useContext(V),[j,N]=m.useState([]),[r,n]=m.useState(!0),o=l&&(s==null?void 0:s.id)==="user_2xugrL6VB89nr5uplXDzYIsrlQq",a=l&&!o,_=s==null?void 0:s.id;m.useEffect(()=>{async function i(){if(d&&l){const f=await O(s.id);N(f)}n(!1)}i()},[d,l,s,o]);const C=async i=>{if(!(!l||o))try{j.includes(i)?(await G(s.id,i),N(j.filter(f=>f!==i)),L.info("Recipe removed from favorites")):(await Y(s.id,i),N([...j,i]),L.success("Recipe added to favorites"))}catch(f){L.error("Something went wrong"),console.error(f)}},I=i=>{alert("Update recipe "+i)};return e.jsxs(e.Fragment,{children:[e.jsx(A,{recipes:b,isSignedIn:l,isAdmin:o,isRegularUser:a,favoriteIds:j,onToggleFavorite:C,onDelete:x,onUpdate:I,userId:_,isLoading:r}),e.jsx(Q,{})]})}export{pe as default};
